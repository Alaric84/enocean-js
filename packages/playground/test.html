<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="http://localhost:3000/socket.io/socket.io.js"></script>
    <style>
     #logger{padding:10px;background:#333;color:#ddd;width:550px;height:200px;overflow:scroll;}
    </style>
  </head>
  <body>
    <div id="info">
      <div>Base Id: <span id="elem_baseid"></span></div>
      <div>remaining write cycles: <span id="elem_rwc"></span></div>
    </div>
    <button id="slp_btn">sleep for 10s</button>
    <div id="logger">
    </div>
    <script type="module">
      import { CommonCommand } from '/node_modules/@enocean-js/common-command/src/CommonCommand.js'
      import { ESP3Packet } from '/node_modules/@enocean-js/esp3-packets/src/index.js'
      import { pretty } from '/node_modules/@enocean-js/pretty-printer/src/pretty-printer.js'
      import { WebsocketSender } from '/node_modules/@enocean-js/websocket-sender/src/websocket-sender.js'
      var socket = io('http://localhost:3000');
      var sender = WebsocketSender(socket)
      var commander = CommonCommand.connect(sender)
      socket.on("data",data=>{
        var packet= ESP3Packet.from(data)
        logger.innerHTML += pretty.logESP3(packet)
        logger.scrollTop = logger.scrollHeight;
      })
      window.addEventListener("load",async ()=>{
        var baseId = await commander.getBaseId()
        elem_baseid.innerHTML= baseId.baseId
        elem_rwc.innerHTML= baseId.remainingWriteCycles
        slp_btn.addEventListener("click",async ()=>{
          await commander.sleep(10000)
        })
      })
    </script>
  </body>
</html>
