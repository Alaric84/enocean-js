import { ESP3Packet } from '../index.js'

export const RadioERP1 = Object.create({})
RadioERP1.from = function (esp3Packet, eepDesc = {}) {
  const packet = esp3Packet
  var res = Object.create({})
  res.packetType = 0x01
  res.RORG = packet.data[0]
  res.senderId = packet.data.slice(packet.data.length - 5, packet.data.length - 1).toString('hex')
  res.status = packet.data[packet.data.length - 1]
  res.subTelNum = packet.optionalData[0]
  res.destinationID = packet.optionalData.slice(1, 5).toString('hex')
  res.RSSI = packet.optionalData[5]
  res.securityLevel = packet.optionalData[6]
  return Object.freeze(res)
}

RadioERP1.connect = function (sender) {
  var packet = ESP3Packet.from('550007070100f600aaaaaaaa0003ffffffffff0000')
  var radioTelegram = RadioERP1.from(packet)
  var members = {
    send (rorg, payload, id, status = 0) {
      radioTelegram = ESP3Packet.from({
        data: [rorg, payload, id, status],
        optionalData: [3, 'ffffffff', 'ff', 0], // always the same for sending ERP1
        packetType: 1 // always the same for sending ERP1
      })
    // pretty.logESP3(commonCommand)
      console.log(radioTelegram.toString('hex'), sender)
      return sender.send(radioTelegram.toString('hex'))
    }
  }
  return Object.freeze(members)
}
export default RadioERP1
