<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
    <style>
     #logger{padding:10px;width:calc(100vw - 100px);height:calc(100vh - 200px);overflow:scroll;}
    </style>
  </head>
  <body>
    <h1>Enocean-JS Socket Gateway</h1>
    <div id="info">
      <div>Base Id: <span id="elem_baseid"></span></div>
      <div>remaining write cycles: <span id="elem_rwc"></span></div>
    </div>
    <div id="logger">
    </div>
    <script type="module">
      import { WebsocketSender, CommonCommand,ESP3Packet, pretty } from 'https://cdn.jsdelivr.net/npm/enocean-js@0.0.1-alpha.11/packages/enocean.js'
      var port = "@@PORT@@"
      console.log('http port:',port)
      var socket = io(`http://localhost:${port}/`);
      var sender = WebsocketSender(socket)
      var commander = CommonCommand.connect(sender)
      //var erp = RadioERP1.connect(sender)

      socket.on("data",data=>{
        var packet= ESP3Packet.from(data)
        //pretty.logESP3(packet)
        console.log(data)
        logger.innerHTML+=pretty.toString(packet)
        logger.scrollTop = logger.scrollHeight;
      })

      window.addEventListener("load",async ()=>{
        var base = await commander.getBaseId()
        elem_baseid.innerHTML= base.baseId
        elem_rwc.innerHTML= base.remainingWriteCycles
      })
    </script>
  </body>
</html>
