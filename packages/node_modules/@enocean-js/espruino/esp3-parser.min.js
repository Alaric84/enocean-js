var $jscomp={scope:{},findInternal:function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(c.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).i}},"es6-impl","es3");
var u8CRC8Table=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,149,146,155,
156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243];function toCRC8(a,c){return u8CRC8Table[a^c]}
var WAIT_FOR_SYNC_BYTE=0,FILL_HEADER=1,CHECK_CRC8_HEADER=2,FILL_DATA_OPTIONALDATA=3,CHECK_CRC8_DATAS=4,Parser=function(){this.maxBufferSize=1E3;this.state=WAIT_FOR_SYNC_BYTE;this.currentESP3Packet=[];this.emitter={data:function(a){}}};Parser.prototype.getDataLength=function(){return 256*this.currentESP3Packet[1]+this.currentESP3Packet[2]};
Parser.prototype.write=function(a){a=a.split("").map(function(a){return a.charCodeAt(0)});for(var c=0;c<a.length;c++){var b=a[c];switch(this.state){case WAIT_FOR_SYNC_BYTE:85===b&&(this.currentESP3Packet=[b],this.state=FILL_HEADER);break;case FILL_HEADER:this.currentESP3Packet.push(b);if(5>this.currentESP3Packet.length)break;this.state=CHECK_CRC8_HEADER;break;case CHECK_CRC8_HEADER:if(this.currentESP3Packet.slice(1).reduce(toCRC8,0)!==b){b=this.currentESP3Packet.findIndex(function(a,b){return 85===
a&&0<b});if(0<b){for(this.state=FILL_HEADER;0<b;)this.currentESP3Packet.shift(),b--;break}console.log("WRONG_HEADER_CHECKSUM_ERROR");this.currentESP3Packet=[];this.state=WAIT_FOR_SYNC_BYTE;break}if(0>=this.getDataLength()+this.currentESP3Packet[3]){console.log("ILLEGAL_PACKET_LENGTH_ERROR");this.currentESP3Packet=[];this.state=WAIT_FOR_SYNC_BYTE;break}this.currentESP3Packet.push(b);this.state=FILL_DATA_OPTIONALDATA;break;case FILL_DATA_OPTIONALDATA:this.currentESP3Packet.push(b);if(this.currentESP3Packet.length>
this.maxBufferSize){this.currentESP3Packet=[];this.state=WAIT_FOR_SYNC_BYTE;console.log("BUFFER_OVERFLOW_ERROR");break}if(this.currentESP3Packet.length<this.getDataLength()+this.currentESP3Packet[3]+6)break;this.state=CHECK_CRC8_DATAS;break;case CHECK_CRC8_DATAS:this.state=WAIT_FOR_SYNC_BYTE,this.currentESP3Packet.slice(6).reduce(toCRC8,0)!==b?console.log("WRONG_BODY_CHECKSUM"):(this.currentESP3Packet.push(b),this.emitter.data(this.currentESP3Packet))}}};
Parser.prototype.on=function(a,c){this.emitter[a]=c};module.exports={Parser:Parser};
