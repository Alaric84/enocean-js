<script type="text/javascript">
  RED.nodes.registerType('enocean-config-node', {
    category: 'config',
    defaults: {
      serialport: { value: "", required: true }
    },
    label: function () {
      return this.serialport;
    },
    oneditprepare: async function(){
      var portListResponse = await fetch("/enocean-js/port/list")
      var portList = await portListResponse.json()
      var opt = portList.map(item=>{
        var option = document.createElement("option")
        option.setAttribute("value",item.comName)
        if(item.comName === this.serialport){
          option.setAttribute("selected","selected")
        }
        option.appendChild(document.createTextNode(`${item.comName} (${item.manufacturer})`))
        document.querySelector("#node-config-input-serialport").appendChild(option)
      })
    }
  });
</script>

<script type="text/x-red"
  data-template-name="enocean-config-node">
  <div class="form-row">
    <label for="node-config-input-serialport"><i class="icon-bookmark"></i> Serialport</label>
    <select id="node-config-input-serialport">
    </select>
  </div>
</script>
